<!DOCTYPE html>
<html>
<head>
  <title>Snake Game</title>
  <link href="https://fonts.googleapis.com/css?family=Antic+Slab" rel="stylesheet">
  <style>
    body {
      margin: 0;
      font-family: 'Antic Slab', serif;
      background: #f4f4f4;
      overflow: hidden;
    }
    #gameCanvas {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      border: 3px solid black;
      background: white;
      touch-action: none;
      width: 90vw;
      height: 90vw;
      max-width: 500px;
      max-height: 500px;
    }
    #score {
      text-align: center;
      font-size: 32px;
      margin-top: 20px;
      font-weight: bold;
    }
    #gameOverScreen {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background-color: rgba(0, 0, 0, 0.9);
      color: white;
      padding: 40px;
      border-radius: 20px;
      display: none;
      animation: fadeIn 0.8s ease-in-out;
      text-align: center;
      font-size: 20px;
      z-index: 1000;
    }
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    #controls {
      position: fixed;
      bottom: 10px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
      justify-content: center;
      background: rgba(255,255,255,0.95);
      padding: 15px;
      border-radius: 15px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }
    #settings {
      position: fixed;
      bottom: 120px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
      justify-content: center;
      background: rgba(255,255,255,0.95);
      padding: 15px;
      border-radius: 15px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }
    button, select {
      font-size: 24px;
      padding: 15px 20px;
      border: none;
      border-radius: 10px;
      background: #4CAF50;
      color: white;
      cursor: pointer;
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
      min-width: 60px;
      min-height: 60px;
    }
    
    button:hover, select:hover {
      background: #45a049;
    }
    
    button:active {
      transform: scale(0.95);
    }
    
    select {
      background: #2196F3;
    }
    
    select:hover {
      background: #1976D2;
    }
  </style>
</head>
<body>
  <div id="score">Score: 0</div>
  <canvas id="gameCanvas" width="500" height="500"></canvas>

  <div id="gameOverScreen">
    <h2>Game Over!</h2>
    <p id="highScoreDisplay"></p>
    <button onclick="initGame()" style="margin-top: 20px; background: #4CAF50;">Play Again</button>
  </div>

  <div id="settings">
    <select id="difficultySelect" onchange="changeDifficulty(this.value)">
      <option value="150">Easy</option>
      <option value="100" selected>Medium</option>
      <option value="70">Hard</option>
    </select>
    <select id="skinSelect" onchange="changeSkin(this.value)">
      <option value="green">Green</option>
      <option value="blue">Blue</option>
      <option value="rainbow">Rainbow</option>
    </select>
  </div>

  <div id="controls">
    <button onclick="setDirection('up')">⬆️</button>
    <button onclick="setDirection('left')">⬅️</button>
    <button onclick="setDirection('down')">⬇️</button>
    <button onclick="setDirection('right')">➡️</button>
  </div>

  <audio id="eatSound" src="https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg"></audio>
  <audio id="dieSound" src="https://actions.google.com/sounds/v1/cartoon/concussive_hit_guitar_boing.ogg"></audio>

  <script>
    let GAME_SPEED = 100;
    let snakeColor = 'lightgreen', snakeBorderColor = 'darkgreen';
    let skin = 'green';
    let score = 0, dx = 10, dy = 0, changingDirection = false;
    let foodX, foodY, snake = [];

    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");

    function initGame() {
      const startX = 250, startY = 250;
      snake = Array.from({ length: 5 }, (_, i) => ({ x: startX - i * 20, y: startY }));
      dx = 20; dy = 0;
      score = 0;
      changingDirection = false;
      document.getElementById("score").innerText = `Score: ${score}`;
      document.getElementById("gameOverScreen").style.display = "none";
      createFood();
      main();
    }

    function main() {
      if (didGameEnd()) {
        playDieSound();
        showGameOver();
        return;
      }
      setTimeout(() => {
        changingDirection = false;
        clearCanvas();
        drawFood();
        advanceSnake();
        drawSnake();
        main();
      }, GAME_SPEED);
    }

    function clearCanvas() {
      ctx.fillStyle = "white";
      ctx.strokeStyle = "black";
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      ctx.strokeRect(0, 0, canvas.width, canvas.height);
    }

    function drawSnakePart(part, index) {
      if (skin === 'rainbow') {
        ctx.fillStyle = `hsl(${(index * 30) % 360}, 100%, 50%)`;
        ctx.strokeStyle = '#222';
      } else {
        ctx.fillStyle = snakeColor;
        ctx.strokeStyle = snakeBorderColor;
      }
      ctx.fillRect(part.x, part.y, 20, 20);
      ctx.strokeRect(part.x, part.y, 20, 20);
    }

    function drawSnake() {
      snake.forEach(drawSnakePart);
    }

    function advanceSnake() {
      const head = { x: snake[0].x + dx, y: snake[0].y + dy };
      snake.unshift(head);
      if (head.x === foodX && head.y === foodY) {
        playEatSound();
        score += 10;
        document.getElementById("score").innerText = `Score: ${score}`;
        createFood();
      } else {
        snake.pop();
      }
    }

    function didGameEnd() {
      return snake.slice(4).some(part => part.x === snake[0].x && part.y === snake[0].y) ||
        snake[0].x < 0 || snake[0].x >= canvas.width || snake[0].y < 0 || snake[0].y >= canvas.height;
    }

    function randomTen(min, max) {
      return Math.round((Math.random() * (max - min) + min) / 20) * 20;
    }

    function createFood() {
      foodX = randomTen(0, canvas.width - 20);
      foodY = randomTen(0, canvas.height - 20);
      if (snake.some(part => part.x === foodX && part.y === foodY)) createFood();
    }

    function drawFood() {
      ctx.fillStyle = 'red';
      ctx.strokeStyle = 'darkred';
      ctx.fillRect(foodX, foodY, 20, 20);
      ctx.strokeRect(foodX, foodY, 20, 20);
    }

    function setDirection(dir) {
      if (changingDirection) return;
      if (dir === 'up' && dy === 0) { dx = 0; dy = -20; }
      if (dir === 'down' && dy === 0) { dx = 0; dy = 20; }
      if (dir === 'left' && dx === 0) { dx = -20; dy = 0; }
      if (dir === 'right' && dx === 0) { dx = 20; dy = 0; }
      changingDirection = true;
    }

    function changeDifficulty(value) {
      GAME_SPEED = parseInt(value);
    }

    function changeSkin(value) {
      skin = value;
      if (value === 'green') {
        snakeColor = 'lightgreen';
        snakeBorderColor = 'darkgreen';
      } else if (value === 'blue') {
        snakeColor = '#00f';
        snakeBorderColor = '#005';
      }
    }

    function showGameOver() {
      const level = document.getElementById("difficultySelect").value;
      const key = "snakeHighScore_" + level;
      const prevHigh = parseInt(localStorage.getItem(key)) || 0;
      const newHigh = Math.max(prevHigh, score);
      localStorage.setItem(key, newHigh);
      document.getElementById("highScoreDisplay").innerText = `High Score: ${newHigh} | Your Score: ${score}`;
      document.getElementById("gameOverScreen").style.display = "block";
    }

    function playEatSound() { document.getElementById("eatSound").play(); }
    function playDieSound() { document.getElementById("dieSound").play(); }

    // Keyboard controls
    document.addEventListener("keydown", e => {
      const keyMap = { 37: 'left', 38: 'up', 39: 'right', 40: 'down' };
      if (keyMap[e.keyCode]) setDirection(keyMap[e.keyCode]);
    });

    // Enhanced swipe controls for mobile
    let startX = null, startY = null;
    
    // Use the entire document for swipe detection
    document.addEventListener("touchstart", e => {
      startX = e.touches[0].clientX;
      startY = e.touches[0].clientY;
      e.preventDefault();
    }, { passive: false });
    
    document.addEventListener("touchmove", e => {
      e.preventDefault();
    }, { passive: false });
    
    document.addEventListener("touchend", e => {
      if (!startX || !startY) return;
      
      let endX = e.changedTouches[0].clientX;
      let endY = e.changedTouches[0].clientY;
      let dxTouch = endX - startX;
      let dyTouch = endY - startY;
      
      // Minimum swipe distance
      const minSwipeDistance = 30;
      
      if (Math.abs(dxTouch) > Math.abs(dyTouch)) {
        // Horizontal swipe
        if (Math.abs(dxTouch) > minSwipeDistance) {
          if (dxTouch > 0) setDirection('right');
          else setDirection('left');
        }
      } else {
        // Vertical swipe
        if (Math.abs(dyTouch) > minSwipeDistance) {
          if (dyTouch > 0) setDirection('down');
          else setDirection('up');
        }
      }
      
      startX = null; 
      startY = null;
    }, { passive: false });

    window.onload = initGame;
  </script>
</body>
</html>